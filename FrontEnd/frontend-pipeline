trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

steps:
- script: |
    echo Building and testing the frontend...
    cd frontend
    npm install
    npm run test
    npm run build
  displayName: 'Build and Test Frontend'

- script: |
    echo Building and pushing Docker image for the frontend...
    docker build -t myregistry.azurecr.io/my-app-frontend:$(Build.BuildId) -f Dockerfile.frontend .
    docker push myregistry.azurecr.io/my-app-frontend:$(Build.BuildId)
  displayName: 'Build and Push Docker Image for Frontend'

- script: |
    echo Deploying the frontend to Azure...
    az acr login --name myregistry
    az acr import --name myregistry --source myregistry.azurecr.io/my-app-frontend:$(Build.BuildId) --image my-app-frontend:$(Build.BuildId)
    az acr show --name myregistry --query loginServer --output tsv
  displayName: 'Deploy Frontend to Azure'
